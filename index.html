<html lang="fr">
  <meta charset="utf8">
  <head>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
      google.charts.load('current', {'packages':['corechart']});
      google.charts.setOnLoadCallback(drawChart);
      function drawChart() {

        var C = document.getElementById('capital').value;
        var T = document.getElementById('taux').value/100;
        var N = document.getElementById('duree').value*12;

        var assurance = parseInt(document.getElementById('assurance').value); // 30€ par mois pour l'assurance

        var M = (C*T/12)/(1-Math.pow((1+T/12), -N));
        var mydata = [['Mois', 'Amortissement', 'Intérêts', 'Assurance', 'Capital dû']];
        var interets, capital, amortissement;
        capital = C;
        for (var i=0; i < N; i++) {
          interets = capital * T / 12; // intérêts mensuels
          amortissement = M - interets;
          capital -= amortissement;
          mydata.push([i, amortissement, interets, assurance, capital]);
        }
        var data = google.visualization.arrayToDataTable(mydata);

        var options = {
          title: 'Simulateur sur '+N+' mois - mensualité de '+M.toLocaleString()+' € + '+ assurance+' € d’assurance',
          vAxis: {title: 'Mensualité'},
          //seriesType: 'bars'
          series: {3: {type: 'line'}},
          isStacked: true
        };

        var chart = new google.visualization.SteppedAreaChart(document.getElementById('chart_div'));

        chart.draw(data, options);
      }
    </script>
  </head>
  <body>
    <div>
      <p>J'emprunte <input id="capital" type="number"> € au taux de <input id="taux" type="text"> % sur <input id="duree" type="number"> ans.</p>
      <p>Je prévois <input type="number" id="assurance"> € d'assurance par mois.</p>
      <p><button onClick="drawChart()">Calculer</button></p>
    </div>
    <div id="chart_div" style="width: 900px; height: 500px;"></div>
  </body>
</html>
